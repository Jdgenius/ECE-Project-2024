//2024.03.26.AE -> Added Sprites
//2024.03.25.AE -> Implemented character buffer
//2024.03.24.AE -> Original Version

//Author: Arnold Etta


void plot_pixel(int x, int y, short int line_color);
void clear_screen();
int abs(int num);
void draw_line(int x0, int y0, int x1, int y1, short int line_colour);
/* write a single character to the character buffer at x,y
 * x in [0,79], y in [0,59]
 */
void write_char(int x, int y, char c) {
  // VGA character buffer
  volatile char * character_buffer = (char *) (0x09000000 + (y<<7) + x);
  *character_buffer = c;
}

int pixel_buffer_start; // global variable

short int apple[676] = {
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0520, 0x0560, 0x05a0, 0x05e0, 0x0620, 0x0660, 0x06a0, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0xb320, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x05c0, 0x0600, 0x0640, 0x0680, 0x0140, 0x0700, 0x0740, 0x0780, 0x0000, 0x0000, 0x0000, 0xb320, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x06c0, 0x0700, 0x0740, 
	0x0780, 0x07c0, 0x07e0, 0x07a0, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x07a0, 0x0000, 0x07c0, 0x0780, 0x0000, 0x0700, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x06c0, 0x0680, 0xb320, 0xb0e0, 0xa900, 0xa120, 0x9940, 0x9160, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xd040, 0xd040, 0xd040, 
	0xd060, 0xc860, 0xc880, 0xb320, 0xb8c0, 0xb0e0, 0xa900, 0x9920, 0x9140, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xd060, 0xd840, 0xd820, 0xe020, 0xe020, 0xd820, 0xd040, 0xd840, 0xb320, 0xd040, 0xc080, 
	0xa8e0, 0xa120, 0x9940, 0x9160, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xd840, 
	0xe020, 0xe800, 0xe800, 0xe800, 0xe020, 0xf000, 0xe240, 0xb320, 0xda80, 0x0000, 0xb0e0, 0xa100, 0x9940, 0x9160, 0x8980, 0x8980, 
	0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xd820, 0xe800, 0xe800, 0xf000, 0xf000, 0xe800, 0xe020, 
	0xd840, 0xc860, 0xc080, 0xb8c0, 0xb0e0, 0xa900, 0x9920, 0x9160, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0xd040, 0xe020, 0xe800, 0xf000, 0xf800, 0xf000, 0xe800, 0xe020, 0xd840, 0xd060, 0xc080, 0xb8c0, 0xb0e0, 0xa900, 
	0x9920, 0x9160, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xd040, 0xd820, 0xe000, 0xe800, 
	0xf000, 0xf000, 0xe800, 0xe020, 0xd840, 0xc860, 0xc080, 0xb8c0, 0xb0e0, 0xa900, 0x9920, 0x9160, 0x8980, 0x8980, 0x8980, 0x8980, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xd840, 0xe020, 0xe800, 0xe800, 0xe800, 0xe020, 0xd820, 0xd040, 0xc880, 
	0xc0a0, 0xb8c0, 0xb0e0, 0xa100, 0x9940, 0x9160, 0x8980, 0x8980, 0x8980, 0x1820, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0xd060, 0xd840, 0xd820, 0xe020, 0xd820, 0xd820, 0xd040, 0xc860, 0xc080, 0xb8a0, 0xb0c0, 0xa900, 0xa120, 0x9940, 0x9160, 
	0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xc880, 0xd060, 0xd040, 0xd040, 0xd040, 
	0xd060, 0xc860, 0xc880, 0xc0a0, 0xb8c0, 0xb0e0, 0xa900, 0x9920, 0x9140, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xc0a0, 0xc080, 0xc880, 0xc880, 0xc880, 0xc880, 0xc080, 0xb8a0, 0xb8c0, 0xb0e0, 0xa900, 
	0xa120, 0x9940, 0x9160, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x7860, 
	0xb8c0, 0xc0a0, 0xc0a0, 0xc0a0, 0xb8a0, 0xb8c0, 0xb0c0, 0xb0e0, 0xa900, 0xa120, 0x9940, 0x9160, 0x8980, 0x8980, 0x8980, 0x8980, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xb0e0, 0xb0c0, 0xb0c0, 0xb0c0, 0xb0c0, 0xb0e0, 
	0xa900, 0xa900, 0xa120, 0x9940, 0x9140, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0xa900, 0xa900, 0xa900, 0xa900, 0xa900, 0xa900, 0xa120, 0xa120, 0x9940, 0x9160, 0x8980, 0x8980, 
	0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xa120, 
	0xa120, 0xa120, 0xa120, 0x9940, 0x9940, 0x9140, 0x9160, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1820, 0x9140, 0x9140, 0x9140, 0x9160, 0x9160, 0x8980, 
	0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x8980, 
	0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x8980, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
	0x0000, 0x0000, 0x0000, 0x0000
};

int main(void)
{
    volatile int * pixel_ctrl_ptr = (int *)0xFF203020;
    /* Read location of the pixel buffer from the pixel buffer controller */
    pixel_buffer_start = *pixel_ctrl_ptr;

    clear_screen();
    /*
	draw_line(0, 0, 150, 150, 0x001F);   // this line is blue
    draw_line(150, 150, 319, 0, 0x07E0); // this line is green
    draw_line(0, 239, 319, 239, 0xF800); // this line is red
    draw_line(319, 0, 0, 239, 0xF81F);   // this line is a pink color
	*/
	
	/*Fruit Box - BLUE*/
	draw_line(80, 30, 80, 210, 0x001F); // Vertical left
	draw_line(310, 30, 310, 210, 0x001F); // Vertical right
	draw_line(80, 30, 310, 30, 0x001F); // Horizontal up
	draw_line(80, 210, 310, 210, 0x001F); // Horizontal down
	
	/*Target Score Box - PURPLE*/
	draw_line(5, 5, 5, 50, 0xF81F); // Vertical left
	draw_line(75, 5, 75, 50, 0xF81F); // Vertical right
	draw_line(5, 5, 75, 5, 0xF81F); // Horizontal up
	draw_line(5, 50, 75, 50, 0xF81F); // Horizontal down
	
	/*Time or Swaps remaining Box - GREEN*/
	draw_line(10, 100, 10, 125, 0x07E0); // Vertical left
	draw_line(70, 100, 70, 125, 0x07E0); // Vertical right
	draw_line(10, 100, 70, 100, 0x07E0); // Horizontal up
	draw_line(10, 125, 70, 125, 0x07E0); // Horizontal down
	
	/*Player Score Box - RED*/
	draw_line(10, 127, 10, 160, 0xF800); // Vertical left
	draw_line(70, 127, 70, 160, 0xF800); // Vertical right
	draw_line(10, 127, 70, 127, 0xF800); // Horizontal up
	draw_line(10, 160, 70, 160, 0xF800); // Horizontal down
	
	// Write Target Score
    char* hw = "Target: 15000";             
   	int x = 3;
   	while (*hw) {
    	write_char(x, 6, *hw);
	 	x++;
	 	hw++;
  	}
	
	// Write Time-left 
    char* hw1 = "89:20";
   	x = 10;
   	while (*hw1) {
    	write_char(x, 28, *hw1);
	 	x++;
	 	hw1++;
  	}
	
	// Write Player Score
    char* hw2 = "Score: ";
   	x = 4;
   	while (*hw2) {
    	write_char(x, 34, *hw2);
	 	x++;
	 	hw2++;
  	}
	
	char* hw3 = "15015980";
   	x = 6;
   	while (*hw3) {
    	write_char(x, 38, *hw3);
	 	x++;
	 	hw3++;
  	}
	
	
	//SPRITES
	
	int apple_x = 85, apple_y = 30;
	int dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
	
	apple_x += 28;
	apple_y = 30;
	dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
	
	apple_x += 28;
	apple_y = 30;
	dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
	
	apple_x += 28;
	apple_y = 30;
	dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
	
	apple_x += 28;
	apple_y = 30;
	dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
	
	apple_x += 28;
	apple_y = 30;
	dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
	
	apple_x += 28;
	apple_y = 30;
	dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
	
	apple_x += 28;
	apple_y = 30;
	dx = 0;
	
	for(int i = 0; i < 676; i++){
		if(i%26 != 0){
			plot_pixel(apple_x+dx, apple_y, apple[i]);
			dx++;
		}else{
			dx = 0;
			apple_y++;
		}
	}
   
}

// code not shown for clear_screen() and draw_line() subroutines

void plot_pixel(int x, int y, short int pixel_color)
{
    volatile short int *one_pixel_address;

        one_pixel_address = pixel_buffer_start + (y << 10) + (x << 1);

        *one_pixel_address = pixel_color;
}

void clear_screen()
{
	for(int y = 0; y < 240; y++){
		for(int x = 0; x < 320; x++){
			plot_pixel(x, y, 0);
		}
	}	
}

int abs(int num)
{
	if(num < 0){
		return -num;
	}else{
		return num;
	}
}

void draw_line(int x0, int y0, int x1, int y1, short int line_colour)
{
	int is_steep = 0;
	if(abs(y1 - y0) > abs(x1 - x0)){
		is_steep = 1;
	}
	
	if(is_steep){
 		// swap(x0, y0)
		int temp = x0;
		x0 = y0;
		y0 = temp;
		
		// swap(x1, y1);
		temp = x1;
		x1 = y1;
		y1 = temp;
	}
 	if(x0 > x1){
 		//swap(x0, x1)
		int temp = x0;
		x0 = x1;
		x1 = temp;
		
 		//swap(y0, y1)
		temp = y0;
		y0 = y1;
		y1 = temp;
	}

 	int deltax = x1 - x0;
 	int deltay = abs(y1 - y0);
 	int error = -(deltax / 2);
 	int y = y0;
	int y_step;
	
 	if(y0 < y1){ 
		y_step = 1;
	}else{
		y_step = -1;
	}
	
 	for(int x = x0; x < x1; x++){
 		if(is_steep){
 			plot_pixel(y, x, line_colour);
		}else{
 			plot_pixel(x, y, line_colour);
 			error = error + deltay;
		}
		
 		if(error > 0){
 			y = y + y_step;
 			error = error - deltax;
		}
	}
}